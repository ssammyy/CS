<div class="min-h-screen bg-gray-50 flex items-stretch">
  <div class="w-full lg:w-1/2 flex items-center justify-center p-6 md:p-8 lg:p-12">
    <div class="relative w-full max-w-md sm:max-w-md md:max-w-lg">
      <div class="mb-8">
        <div class="flex items-center gap-1 mb-4">
          <span class="text-3xl font-bold text-brand-coral">s</span>
          <span class="text-3xl font-bold text-brand-sky">a</span>
          <span class="text-3xl font-bold text-brand-mint">a</span>
          <span class="text-3xl font-bold text-brand-coral">m</span>
          <span class="text-3xl font-bold text-gray-900">POS</span>
        </div>
        <div class="h-1.5 w-16 rounded-full bg-gradient-to-r from-brand-coral to-brand-sky mb-4"></div>
        <h2 class="text-2xl sm:text-3xl font-semibold">Change Password</h2>
        <p class="text-gray-600 mt-1 text-sm">You must set a new password before continuing.</p>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="mt-2 space-y-4 sm:space-y-5">
        <mat-form-field class="w-full" color="primary">
          <mat-label>Current (temporary) password</mat-label>
          <mat-icon matPrefix class="mr-2 opacity-60">lock</mat-icon>
          <input matInput [type]="hideCurrentPassword ? 'password' : 'text'" formControlName="currentPassword" autocomplete="current-password" required />
          <button mat-icon-button matSuffix type="button" (click)="hideCurrentPassword = !hideCurrentPassword" [attr.aria-label]="hideCurrentPassword ? 'Show password' : 'Hide password'">
            <mat-icon>{{ hideCurrentPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          <mat-error *ngIf="form.controls.currentPassword.invalid && form.controls.currentPassword.touched">
            Current password is required
          </mat-error>
        </mat-form-field>

        <mat-form-field class="w-full" color="primary">
          <mat-label>New password</mat-label>
          <mat-icon matPrefix class="mr-2 opacity-60">lock</mat-icon>
          <input matInput [type]="hideNewPassword ? 'password' : 'text'" formControlName="newPassword" autocomplete="new-password" required />
          <button mat-icon-button matSuffix type="button" (click)="hideNewPassword = !hideNewPassword" [attr.aria-label]="hideNewPassword ? 'Show password' : 'Hide password'">
            <mat-icon>{{ hideNewPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          <mat-error *ngIf="form.controls.newPassword.invalid && form.controls.newPassword.touched">
            New password must be at least 6 characters
          </mat-error>
        </mat-form-field>

        <mat-form-field class="w-full" color="primary">
          <mat-label>Confirm new password</mat-label>
          <mat-icon matPrefix class="mr-2 opacity-60">lock</mat-icon>
          <input matInput [type]="hideConfirmPassword ? 'password' : 'text'" formControlName="confirmPassword" autocomplete="new-password" required />
          <button mat-icon-button matSuffix type="button" (click)="hideConfirmPassword = !hideConfirmPassword" [attr.aria-label]="hideConfirmPassword ? 'Show password' : 'Hide password'">
            <mat-icon>{{ hideConfirmPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          <mat-error *ngIf="form.getError('passwordMismatch') && form.controls.confirmPassword.touched">
            Passwords do not match
          </mat-error>
          <mat-error *ngIf="!form.getError('passwordMismatch') && form.controls.confirmPassword.invalid && form.controls.confirmPassword.touched">
            Confirm password is required
          </mat-error>
        </mat-form-field>

        <div *ngIf="errorMessage()" class="bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3">
          <mat-icon class="text-red-600 flex-shrink-0">error</mat-icon>
          <p class="text-sm text-red-700 flex-1">{{ errorMessage() }}</p>
          <button type="button" (click)="errorMessage.set(null)" class="text-red-600 hover:text-red-800 flex-shrink-0" aria-label="Dismiss">
            <mat-icon class="text-base">close</mat-icon>
          </button>
        </div>

        <button mat-raised-button class="w-full !py-3 !text-base text-white bg-gradient-to-r from-brand-coral to-brand-sky hover:opacity-95 transition disabled:opacity-50 disabled:cursor-not-allowed" type="submit" [disabled]="form.invalid || loading()">
          <span *ngIf="!loading()">Change Password</span>
          <span *ngIf="loading()" class="flex items-center justify-center gap-2">
            <mat-spinner diameter="20"></mat-spinner>
            <span>Updating...</span>
          </span>
        </button>
      </form>

      <div class="mt-6 text-sm text-gray-600">
        <button type="button" (click)="authService.logout(); router.navigate(['/login'])" class="text-brand-coral hover:underline">
          Sign out
        </button>
      </div>
    </div>
  </div>

  <div class="hidden xl:flex w-1/2 p-6 lg:p-10 xl:p-14">
    <div class="flex-1 rounded-[2rem] bg-[#A1C7F8] relative overflow-hidden">
      <div class="absolute inset-0 opacity-20">
        <div class="absolute top-10 left-10 w-32 h-32 rounded-full bg-[#CBEBD0] blur-xl"></div>
        <div class="absolute top-1/3 right-16 w-24 h-24 rounded-full bg-[#F99E98] blur-lg"></div>
      </div>
      <div class="relative z-10 p-8 lg:p-12 h-full flex flex-col justify-center text-gray-900">
        <div class="max-w-md">
          <h3 class="text-2xl font-bold mb-4 text-gray-900">Welcome to SaamPOS</h3>
          <p class="text-gray-700 leading-relaxed">
            For security, please set a new password. Choose something memorable and at least 6 characters long.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
